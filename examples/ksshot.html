<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>kscreenshot</title>
    <style type="text/css">
    body,
    html {
        width: 100%;
        height: 100%;
        margin: 0;
        overflow: hidden;
    }

    #app {

        width: 100%;
        height: 100%;
        background-color: #fff;
        z-index: 99999;
    }

    #container {
        width: 600px;
        height: 400px;
    }
    </style>
</head>

<body>
    <div id="app">
        <div id="container"></div>
    </div>
</body>
<!-- 引入echart -->
<script src="https://lib.baomitu.com/echarts/5.0.2/echarts.common.js"></script>
<!-- 引入kscreen -->
<script src="../dist/kss.dev.js"></script>
<script>
var chartDom = document.getElementById('container');

var myChart = echarts.init(chartDom);
var option;

option = {
    xAxis: {
        type: 'category',
        data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
    },
    yAxis: {
        type: 'value'
    },
    series: [{
        data: [150, 230, 224, 218, 135, 147, 260],
        type: 'line'
    }]
};

option && myChart.setOption(option);


function base64ToBlob({ b64data = '', contentType = '', sliceSize = 512 } = {}) {
    return new Promise((resolve, reject) => {
        // 使用 atob() 方法将数据解码
        let byteCharacters = atob(b64data);
        let byteArrays = [];
        for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {
            let slice = byteCharacters.slice(offset, offset + sliceSize);
            let byteNumbers = [];
            for (let i = 0; i < slice.length; i++) {
                byteNumbers.push(slice.charCodeAt(i));
            }
            // 8 位无符号整数值的类型化数组。内容将初始化为 0。
            // 如果无法分配请求数目的字节，则将引发异常。
            byteArrays.push(new Uint8Array(byteNumbers));
        }
        let result = new Blob(byteArrays, {
            type: contentType
        })
        result = Object.assign(result, {
            // 这里一定要处理一下 URL.createObjectURL
            preview: URL.createObjectURL(result),
            name: `temp.png`
        });
        resolve(result)
    })
}

//https://www.npmjs.com/package/kscreenshot
//65指键盘中的A
new kscreen({
    key: 65,
    endCB: (base64Image) => {
        let base64 = base64Image.split(',')[1];
        base64ToBlob({ b64data: base64, contentType: 'image/png' }).then(res => {
            // 转后后的blob对象
            try {
                // https://w3c.github.io/clipboard-apis/
                let clipboard = navigator.clipboard;
                if (clipboard == undefined) {
                    console.log('clipboard is undefined');
                } else {
                    let data = [new ClipboardItem({ 'image/png': res })];

                    navigator.clipboard.write(data).then(function() {
                        console.log("Copied to clipboard successfully!");
                    }, function() {
                        console.error("Unable to write to clipboard. :-(");
                    });
                }

            } catch (error) {
                console.error(error);
            }
        })
    },
    // cancelCB:()=>{
    //     console.log('canlel')
    // }
})
</script>

</html>