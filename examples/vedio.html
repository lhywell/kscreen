<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>kscreenshot-vedio</title>
    <style type="text/css">
    body,
    html {
        width: 100%;
        height: 100%;
        margin: 0;
        overflow: hidden;
    }

    #app {

        width: 100%;
        height: 100%;
        background-color: #fff;
    }

    #main {
        width: 600px;
        height: 400px;
    }

    .video-box {
        width: 100%;
        height: 100%;
        max-height: 400px;
        overflow: hidden;
    }

    .video-box video {
        width: 100%;
        height: 100%;
        object-fit: contain;
        background-color: #000000;
    }
    </style>
</head>

<body>
    <div id="app">
        <!-- video视频暂不支持 -->
        <div>
            <video crossOrigin id="video1" controls src="http://bailian-yuanchu-doc.oss-cn-beijing.aliyuncs.com/video/%E5%87%BA%E5%8F%A3%E6%99%BA%E8%83%BD.mp4"></video>
            <canvas width="200" height="200" id="canva1"></canvas>
        </div>
        <div>
            <canvas width="200" height="200" id="video1ToCanvas"></canvas>
            <canvas width="200" height="200" id="canvas1ToCanvas"></canvas>
        </div>
        <div>
            <img width="200" height="200" id="video1ToCanvasToImg"></img>
            <img width="200" height="200" id="canvas1ToCanvasToImg"></img>
        </div>
        <style>
        video,
        canvas {
            width: 200px;
            height: 200px;
            display: inline-block;
            vertical-align: top;
        }
        </style>
    </div>
</body>
<!-- 引入jquery -->
<!-- 引入kss -->
<script src="../dist/kscreen.dev.js"></script>
<script>
ctx1 = canva1.getContext('2d')
setInterval(v => {
    ctx1.drawImage(video1, 0, 0, 200, 200)
}, 100)
ctx2 = video1ToCanvas.getContext('2d')
setInterval(v => {
    ctx2.drawImage(video1, 0, 0, 200, 200)
}, 200)
ctx3 = canvas1ToCanvas.getContext('2d')
setInterval(v => {
    ctx3.drawImage(canva1, 0, 0, 200, 200)
}, 200)
video1.currentTime = 0;
video1.play()
setInterval(v => {
    video1ToCanvasToImg.src = video1ToCanvas.toDataURL('image/jpeg')
    canvas1ToCanvasToImg.src = canvas1ToCanvas.toDataURL('image/jpeg')
}, 200)


function base64ToBlob({ b64data = '', contentType = '', sliceSize = 512 } = {}) {
    return new Promise((resolve, reject) => {
        // 使用 atob() 方法将数据解码
        let byteCharacters = atob(b64data);
        let byteArrays = [];
        for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {
            let slice = byteCharacters.slice(offset, offset + sliceSize);
            let byteNumbers = [];
            for (let i = 0; i < slice.length; i++) {
                byteNumbers.push(slice.charCodeAt(i));
            }
            // 8 位无符号整数值的类型化数组。内容将初始化为 0。
            // 如果无法分配请求数目的字节，则将引发异常。
            byteArrays.push(new Uint8Array(byteNumbers));
        }
        let result = new Blob(byteArrays, {
            type: contentType
        })
        result = Object.assign(result, {
            // 这里一定要处理一下 URL.createObjectURL
            preview: URL.createObjectURL(result),
            name: `temp.png`
        });
        resolve(result)
    })
}

//https://www.npmjs.com/package/kscreenshot
//65指键盘中的A
new kscreen({
    key: 65,
    endCB: (base64Image) => {
        let base64 = base64Image.split(',')[1];
        base64ToBlob({ b64data: base64, contentType: 'image/png' }).then(res => {
            // 转后后的blob对象
            try {
                // https://w3c.github.io/clipboard-apis/
                let clipboard = navigator.clipboard;
                if (clipboard == undefined) {
                    console.log('clipboard is undefined');
                } else {
                    let data = [new ClipboardItem({ 'image/png': res })];

                    navigator.clipboard.write(data).then(function() {
                        console.log("Copied to clipboard successfully!");
                    }, function() {
                        console.error("Unable to write to clipboard. :-(");
                    });
                }

            } catch (error) {
                console.error(error);
            }
        })
    },
    // cancelCB:()=>{
    //     console.log('canlel')
    // }
})
</script>

</html>